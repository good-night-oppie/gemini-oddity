#!/bin/bash
# Oppie Dockhand Project Initialization Script

set -e

echo "ðŸš€ Initializing Oppie Dockhand Project..."

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Check prerequisites
echo -e "${YELLOW}Checking prerequisites...${NC}"
command -v docker >/dev/null 2>&1 || { echo "Docker is required but not installed. Aborting." >&2; exit 1; }
command -v git >/dev/null 2>&1 || { echo "Git is required but not installed. Aborting." >&2; exit 1; }

# Create project structure
echo -e "${YELLOW}Creating project structure...${NC}"
mkdir -p {core,rag,orchestration,frontend,infra,tests,scripts,config}
mkdir -p experiments/{frontend,backend,ml,integration,shared}
mkdir -p docs/{guides,architecture,api}

# Initialize Git repository
if [ ! -d .git ]; then
    echo -e "${YELLOW}Initializing Git repository...${NC}"
    git init
    git add .
    git commit -m "Initial commit: Oppie Dockhand MVP setup"
fi

# Install pre-commit hooks
echo -e "${YELLOW}Installing pre-commit hooks...${NC}"
if command -v pre-commit >/dev/null 2>&1; then
    pre-commit install
else
    echo "pre-commit not found, skipping hook installation"
fi

# Set up development environment
echo -e "${YELLOW}Setting up development environment...${NC}"
if [ -f .devcontainer/devcontainer.json ]; then
    echo "DevContainer configuration found"
    echo "To start development environment:"
    echo "  1. Open in VS Code"
    echo "  2. Click 'Reopen in Container'"
    echo "  OR"
    echo "  Run: make dev"
fi

# Create initial configuration
echo -e "${YELLOW}Creating initial configuration...${NC}"
cat > config/development.yaml <<EOF
environment: development
debug: true
log_level: debug

server:
  host: 0.0.0.0
  port: 8080

database:
  host: localhost
  port: 5432
  name: oppie_dev
  user: oppie
  password: oppie-dev

redis:
  host: localhost
  port: 6379

features:
  experimental: true
  telemetry: false
EOF

# Create .env.example
cat > .env.example <<EOF
# Environment
NODE_ENV=development
ENVIRONMENT=development

# API Keys (obtain from team lead)
OPENAI_API_KEY=
ANTHROPIC_API_KEY=

# Database
DATABASE_URL=postgresql://oppie:oppie-dev@localhost:5432/oppie_dev

# Redis
REDIS_URL=redis://localhost:6379

# S3/MinIO
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin

# Observability
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
EOF

# Set executable permissions
chmod +x scripts/*.sh
chmod +x .devcontainer/post-create.sh

echo -e "${GREEN}âœ… Project initialization complete!${NC}"
echo ""
echo "Next steps:"
echo "1. Copy .env.example to .env and fill in API keys"
echo "2. Run 'make dev' to start development environment"
echo "3. Run 'make help' to see available commands"
echo "4. Check docs/SETUP_SUMMARY.md for full documentation"
echo ""
echo "Happy coding! ðŸŽ‰"